   1               		.file	"external_interrupt.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__CCP__ = 0x34
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  10               		.text
  11               	.Ltext0:
  12               		.cfi_sections	.debug_frame
  13               	.global	init_external_interrupts
  15               	init_external_interrupts:
  16               	.LFB0:
  17               		.file 1 "external_interrupt.c"
   1:external_interrupt.c **** /*
   2:external_interrupt.c ****  * external_interrupt.c
   3:external_interrupt.c ****  *
   4:external_interrupt.c ****  * Written by Peter Sutton.
   5:external_interrupt.c ****  */ 
   6:external_interrupt.c **** 
   7:external_interrupt.c **** #ifdef AVR
   8:external_interrupt.c **** #include <avr/io.h>
   9:external_interrupt.c **** #include <avr/interrupt.h>
  10:external_interrupt.c **** #endif
  11:external_interrupt.c **** #include "external_interrupt.h"
  12:external_interrupt.c **** 
  13:external_interrupt.c **** /* The last button pushed. Can be overwritten if button_pushed() is not called
  14:external_interrupt.c ****  * before the next button push happens. Value will be 0 to 3 if a button is pushed.
  15:external_interrupt.c ****  */
  16:external_interrupt.c **** static volatile int8_t last_button_pushed = -1;
  17:external_interrupt.c **** 
  18:external_interrupt.c **** void init_external_interrupts(void) {
  18               		.loc 1 18 0
  19               		.cfi_startproc
  20               	/* prologue: function */
  21               	/* frame size = 0 */
  22               	/* stack size = 0 */
  23               	.L__stack_usage = 0
  19:external_interrupt.c **** #ifdef AVR
  20:external_interrupt.c **** 	/* Enable the required external interrupts 0 to 3. We set up 
  21:external_interrupt.c **** 	 * each interrupt to look for a falling edge event.
  22:external_interrupt.c **** 	 * Global interrupts will also need to be enabled (not done here).
  23:external_interrupt.c **** 	 */
  24:external_interrupt.c **** 	EICRA = (1<<ISC31)|(0<<ISC30)|
  24               		.loc 1 24 0
  25 0000 8AEA      		ldi r24,lo8(-86)
  26 0002 8093 6A00 		sts 106,r24
  25:external_interrupt.c **** 			(1<<ISC21)|(0<<ISC20)|
  26:external_interrupt.c **** 			(1<<ISC11)|(0<<ISC10)|
  27:external_interrupt.c **** 			(1<<ISC01)|(0<<ISC00);
  28:external_interrupt.c **** 	EIMSK = (1<<INT0)|(1<<INT1)|(1<<INT2)|(1<<INT3);
  27               		.loc 1 28 0
  28 0006 8FE0      		ldi r24,lo8(15)
  29 0008 89BF      		out 89-32,r24
  29:external_interrupt.c **** 	EIFR = (1<<INTF0)|(1<<INTF1)|(1<<INTF2)|(1<<INTF3);	
  30               		.loc 1 29 0
  31 000a 88BF      		out 88-32,r24
  30:external_interrupt.c **** 
  31:external_interrupt.c **** #endif
  32:external_interrupt.c **** 	last_button_pushed = -1;
  32               		.loc 1 32 0
  33 000c 8FEF      		ldi r24,lo8(-1)
  34 000e 8093 0000 		sts last_button_pushed,r24
  35               	/* epilogue start */
  33:external_interrupt.c **** }
  36               		.loc 1 33 0
  37 0012 0895      		ret
  38               		.cfi_endproc
  39               	.LFE0:
  41               	.global	button_pushed
  43               	button_pushed:
  44               	.LFB1:
  34:external_interrupt.c **** 
  35:external_interrupt.c **** int8_t button_pushed() {
  45               		.loc 1 35 0
  46               		.cfi_startproc
  47               	/* prologue: function */
  48               	/* frame size = 0 */
  49               	/* stack size = 0 */
  50               	.L__stack_usage = 0
  36:external_interrupt.c **** #ifdef AVR
  37:external_interrupt.c **** 	int8_t interrupts_enabled;
  38:external_interrupt.c **** 	int8_t button;
  39:external_interrupt.c **** 	
  40:external_interrupt.c **** 	/* Turn off interrupts (if enabled) while we access last_button_pushed */
  41:external_interrupt.c **** 	interrupts_enabled = bit_is_set(SREG, SREG_I);
  51               		.loc 1 41 0
  52 0014 9FB7      		in r25,__SREG__
  53               	.LVL0:
  42:external_interrupt.c **** 	cli();
  54               		.loc 1 42 0
  55               	/* #APP */
  56               	 ;  42 "external_interrupt.c" 1
  57 0016 F894      		cli
  58               	 ;  0 "" 2
  43:external_interrupt.c **** 	button = last_button_pushed;
  59               		.loc 1 43 0
  60               	/* #NOAPP */
  61 0018 8091 0000 		lds r24,last_button_pushed
  62               	.LVL1:
  44:external_interrupt.c **** 	last_button_pushed = -1;
  63               		.loc 1 44 0
  64 001c 2FEF      		ldi r18,lo8(-1)
  65 001e 2093 0000 		sts last_button_pushed,r18
  45:external_interrupt.c **** 	/* If interrupts were on, turn them back on */
  46:external_interrupt.c **** 	if(interrupts_enabled) {
  66               		.loc 1 46 0
  67 0022 97FF      		sbrs r25,7
  68 0024 00C0      		rjmp .L3
  47:external_interrupt.c **** 		sei();
  69               		.loc 1 47 0
  70               	/* #APP */
  71               	 ;  47 "external_interrupt.c" 1
  72 0026 7894      		sei
  73               	 ;  0 "" 2
  74               	/* #NOAPP */
  75               	.L3:
  48:external_interrupt.c **** 	}
  49:external_interrupt.c **** 	return button;
  50:external_interrupt.c **** #else
  51:external_interrupt.c **** 	/* Non AVR - buttons can never be pressed */
  52:external_interrupt.c **** 	return -1;
  53:external_interrupt.c **** #endif
  54:external_interrupt.c **** }
  76               		.loc 1 54 0
  77 0028 0895      		ret
  78               		.cfi_endproc
  79               	.LFE1:
  81               	.global	__vector_1
  83               	__vector_1:
  84               	.LFB3:
  55:external_interrupt.c **** 
  56:external_interrupt.c **** #ifdef AVR
  57:external_interrupt.c **** /* Called from our button interrupt handlers. (We know that interrupts
  58:external_interrupt.c ****  * are disabled when we get here.) We record the button that has been pushed.
  59:external_interrupt.c ****  */
  60:external_interrupt.c **** static void handle_button_push(int8_t button) {
  61:external_interrupt.c **** 	last_button_pushed = button;
  62:external_interrupt.c **** }
  63:external_interrupt.c **** 
  64:external_interrupt.c **** /* Interrupt handler for button 0 button push */
  65:external_interrupt.c **** ISR(INT0_vect) {
  85               		.loc 1 65 0
  86               		.cfi_startproc
  87 002a 1F92      		push r1
  88               	.LCFI0:
  89               		.cfi_def_cfa_offset 3
  90               		.cfi_offset 1, -2
  91 002c 0F92      		push r0
  92               	.LCFI1:
  93               		.cfi_def_cfa_offset 4
  94               		.cfi_offset 0, -3
  95 002e 0FB6      		in r0,__SREG__
  96 0030 0F92      		push r0
  97 0032 1124      		clr __zero_reg__
  98               	/* prologue: Signal */
  99               	/* frame size = 0 */
 100               	/* stack size = 3 */
 101               	.L__stack_usage = 3
 102               	.LVL2:
 103               	.LBB10:
 104               	.LBB11:
  61:external_interrupt.c **** 	last_button_pushed = button;
 105               		.loc 1 61 0
 106 0034 1092 0000 		sts last_button_pushed,__zero_reg__
 107               	/* epilogue start */
 108               	.LBE11:
 109               	.LBE10:
  66:external_interrupt.c **** 	handle_button_push(0);
  67:external_interrupt.c **** }
 110               		.loc 1 67 0
 111 0038 0F90      		pop r0
 112 003a 0FBE      		out __SREG__,r0
 113 003c 0F90      		pop r0
 114 003e 1F90      		pop r1
 115 0040 1895      		reti
 116               		.cfi_endproc
 117               	.LFE3:
 119               	.global	__vector_2
 121               	__vector_2:
 122               	.LFB4:
  68:external_interrupt.c **** 
  69:external_interrupt.c **** /* Interrupt handler for button 1 button push */
  70:external_interrupt.c **** ISR(INT1_vect) {
 123               		.loc 1 70 0
 124               		.cfi_startproc
 125 0042 1F92      		push r1
 126               	.LCFI2:
 127               		.cfi_def_cfa_offset 3
 128               		.cfi_offset 1, -2
 129 0044 0F92      		push r0
 130               	.LCFI3:
 131               		.cfi_def_cfa_offset 4
 132               		.cfi_offset 0, -3
 133 0046 0FB6      		in r0,__SREG__
 134 0048 0F92      		push r0
 135 004a 1124      		clr __zero_reg__
 136 004c 8F93      		push r24
 137               	.LCFI4:
 138               		.cfi_def_cfa_offset 5
 139               		.cfi_offset 24, -4
 140               	/* prologue: Signal */
 141               	/* frame size = 0 */
 142               	/* stack size = 4 */
 143               	.L__stack_usage = 4
 144               	.LVL3:
 145               	.LBB12:
 146               	.LBB13:
  61:external_interrupt.c **** 	last_button_pushed = button;
 147               		.loc 1 61 0
 148 004e 81E0      		ldi r24,lo8(1)
 149 0050 8093 0000 		sts last_button_pushed,r24
 150               	/* epilogue start */
 151               	.LBE13:
 152               	.LBE12:
  71:external_interrupt.c **** 	handle_button_push(1);
  72:external_interrupt.c **** }
 153               		.loc 1 72 0
 154 0054 8F91      		pop r24
 155 0056 0F90      		pop r0
 156 0058 0FBE      		out __SREG__,r0
 157 005a 0F90      		pop r0
 158 005c 1F90      		pop r1
 159 005e 1895      		reti
 160               		.cfi_endproc
 161               	.LFE4:
 163               	.global	__vector_3
 165               	__vector_3:
 166               	.LFB5:
  73:external_interrupt.c **** 
  74:external_interrupt.c **** /* Interrupt handler for button 2 button push */
  75:external_interrupt.c **** ISR(INT2_vect) {
 167               		.loc 1 75 0
 168               		.cfi_startproc
 169 0060 1F92      		push r1
 170               	.LCFI5:
 171               		.cfi_def_cfa_offset 3
 172               		.cfi_offset 1, -2
 173 0062 0F92      		push r0
 174               	.LCFI6:
 175               		.cfi_def_cfa_offset 4
 176               		.cfi_offset 0, -3
 177 0064 0FB6      		in r0,__SREG__
 178 0066 0F92      		push r0
 179 0068 1124      		clr __zero_reg__
 180 006a 8F93      		push r24
 181               	.LCFI7:
 182               		.cfi_def_cfa_offset 5
 183               		.cfi_offset 24, -4
 184               	/* prologue: Signal */
 185               	/* frame size = 0 */
 186               	/* stack size = 4 */
 187               	.L__stack_usage = 4
 188               	.LVL4:
 189               	.LBB14:
 190               	.LBB15:
  61:external_interrupt.c **** 	last_button_pushed = button;
 191               		.loc 1 61 0
 192 006c 82E0      		ldi r24,lo8(2)
 193 006e 8093 0000 		sts last_button_pushed,r24
 194               	/* epilogue start */
 195               	.LBE15:
 196               	.LBE14:
  76:external_interrupt.c **** 	handle_button_push(2);
  77:external_interrupt.c **** }
 197               		.loc 1 77 0
 198 0072 8F91      		pop r24
 199 0074 0F90      		pop r0
 200 0076 0FBE      		out __SREG__,r0
 201 0078 0F90      		pop r0
 202 007a 1F90      		pop r1
 203 007c 1895      		reti
 204               		.cfi_endproc
 205               	.LFE5:
 207               	.global	__vector_4
 209               	__vector_4:
 210               	.LFB6:
  78:external_interrupt.c **** 
  79:external_interrupt.c **** /* Interrupt handler for button 3 button push */
  80:external_interrupt.c **** ISR(INT3_vect) {
 211               		.loc 1 80 0
 212               		.cfi_startproc
 213 007e 1F92      		push r1
 214               	.LCFI8:
 215               		.cfi_def_cfa_offset 3
 216               		.cfi_offset 1, -2
 217 0080 0F92      		push r0
 218               	.LCFI9:
 219               		.cfi_def_cfa_offset 4
 220               		.cfi_offset 0, -3
 221 0082 0FB6      		in r0,__SREG__
 222 0084 0F92      		push r0
 223 0086 1124      		clr __zero_reg__
 224 0088 8F93      		push r24
 225               	.LCFI10:
 226               		.cfi_def_cfa_offset 5
 227               		.cfi_offset 24, -4
 228               	/* prologue: Signal */
 229               	/* frame size = 0 */
 230               	/* stack size = 4 */
 231               	.L__stack_usage = 4
 232               	.LVL5:
 233               	.LBB16:
 234               	.LBB17:
  61:external_interrupt.c **** 	last_button_pushed = button;
 235               		.loc 1 61 0
 236 008a 83E0      		ldi r24,lo8(3)
 237 008c 8093 0000 		sts last_button_pushed,r24
 238               	/* epilogue start */
 239               	.LBE17:
 240               	.LBE16:
  81:external_interrupt.c **** 	handle_button_push(3);
  82:external_interrupt.c **** }
 241               		.loc 1 82 0
 242 0090 8F91      		pop r24
 243 0092 0F90      		pop r0
 244 0094 0FBE      		out __SREG__,r0
 245 0096 0F90      		pop r0
 246 0098 1F90      		pop r1
 247 009a 1895      		reti
 248               		.cfi_endproc
 249               	.LFE6:
 251               		.data
 254               	last_button_pushed:
 255 0000 FF        		.byte	-1
 256               		.text
 257               	.Letext0:
 258               		.file 2 "/usr/local/CrossPack-AVR-20130212/lib/gcc/avr/4.6.2/../../../../avr/include/stdint.h"
DEFINED SYMBOLS
                            *ABS*:00000000 external_interrupt.c
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:2      *ABS*:0000003f __SREG__
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:3      *ABS*:0000003e __SP_H__
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:4      *ABS*:0000003d __SP_L__
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:5      *ABS*:00000034 __CCP__
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:6      *ABS*:00000000 __tmp_reg__
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:7      *ABS*:00000001 __zero_reg__
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:15     .text:00000000 init_external_interrupts
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:254    .data:00000000 last_button_pushed
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:43     .text:00000014 button_pushed
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:83     .text:0000002a __vector_1
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:121    .text:00000042 __vector_2
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:165    .text:00000060 __vector_3
/var/folders/5q/cbspj09573sdz95ppjc1lv4w0000gn/T//ccswWR9d.s:209    .text:0000007e __vector_4

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
